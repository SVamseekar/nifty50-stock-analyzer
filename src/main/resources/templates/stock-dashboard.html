<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:insert="~{fragments/header.html}"></head>
<body>
<div th:replace="~{fragments/common.html ::common ('Stock Dashboard')}"></div>

<div>
    <!-- Summary Cards -->
    <div class="summary-cards">
        <div class="summary-card">
            <h3><i class="fas fa-chart-line"></i> Total Stocks</h3>
            <span class="summary-value" th:text="${totalStocks ?: '50'}">50</span>
        </div>
        <div class="summary-card">
            <h3><i class="fas fa-database"></i> Data Points</h3>
            <span class="summary-value" th:text="${#numbers.formatInteger(totalDataPoints ?: 0, 0, 'COMMA')}">0</span>
        </div>
        <div class="summary-card">
            <h3><i class="fas fa-calendar"></i> Days Analyzed</h3>
            <span class="summary-value" th:text="${daysAnalyzed ?: '0'}">0</span>
        </div>
        <div class="summary-card">
            <h3><i class="fas fa-clock"></i> Status</h3>
            <span class="summary-value status-completed">Ready</span>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
        <div>
            <form action="/api/stocks/trigger-job" method="post" style="display: inline;">
                <button type="submit" onclick="return confirm('Start data fetch job? This may take several minutes.')">
                    <i class="fas fa-download"></i> Fetch Latest Data
                </button>
            </form>
            
            <a th:href="@{/stock-analysis}">
                <button type="button"><i class="fas fa-search"></i> Stock Analysis</button>
            </a>
            
            <a href="/api/stocks/health" target="_blank">
                <button type="button"><i class="fas fa-heartbeat"></i> API Health</button>
            </a>
        </div>
    </div>

    <!-- System Status -->
    <div class="quick-actions">
        <h3><i class="fas fa-server"></i> System Status</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
                <strong>API Status:</strong> 
                <span class="status-completed">Connected</span>
            </div>
            <div>
                <strong>Database:</strong> 
                <span class="status-completed">Connected</span>
            </div>
            <div>
                <strong>Scheduler:</strong> 
                <span class="status-completed">Active</span>
            </div>
            <div>
                <strong>Kite API:</strong> 
                <span class="status-completed">Authenticated</span>
            </div>
        </div>
    </div>

    <!-- Recent Jobs -->
    <div style="margin-top: 30px;">
        <h3><i class="fas fa-history"></i> Recent Jobs</h3>
        <table>
            <thead>
                <tr>
                    <th>Job Name</th>
                    <th>Status</th>
                    <th>Last Run</th>
                    <th>Message</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="job : ${recentJobs}" th:if="${job != null}">
                    <td th:text="${job.jobName ?: 'Unknown'}">stock_data_fetch</td>
                    <td>
                        <span th:class="'status-' + ${job.status != null ? job.status.toLowerCase() : 'unknown'}" 
                              th:text="${job.status ?: 'UNKNOWN'}">SUCCESS</span>
                    </td>
                    <td th:text="${job.lastRun != null ? #temporals.format(job.lastRun, 'dd-MM-yyyy HH:mm') : 'Never'}">20-09-2025 14:59</td>
                    <td th:text="${job.message ?: 'No details'}">Job completed</td>
                </tr>
                <tr th:if="${recentJobs == null or #lists.isEmpty(recentJobs)}">
                    <td colspan="4" style="text-align: center; color: #6c757d;">No recent jobs</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div th:replace="~{fragments/common.html ::footer}"></div>

<script th:replace="~{fragments/common.html ::clock-script}"></script>

</body>
</html>